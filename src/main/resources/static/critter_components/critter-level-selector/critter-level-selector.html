<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../critter-button/critter-button.html">
<link rel="import" href="../critter-selector/critter-selector.html">


<!--
# critter-insert

A Simple Button

## Example
```html
<critter-level-selector></critter-level-selector>
```

@demo
-->

<dom-module id="critter-level-selector">
    <template>
        <style>
            #load_button{
                margin: var( --margin-selector-button);
            }
        </style>
        <critter-selector values="{{levels}}" selected-value="{{selectedLevel}}"></critter-selector>
        <br>
        <critter-button id="load_button">Load Level</critter-button>
    </template>
    <script>
        class CritterLevelSelector extends Polymer.Element {
            static get is() {
                return 'critter-level-selector';
            }

            static get properties() {
                return {
                    levels: {
                        type: []
                    },

                    selectedLevel: {
                        type: String,
                        value: ""
                    }
                }
            }

            connectedCallback() {
                super.connectedCallback();

                Polymer.RenderStatus.afterNextRender(this, function () {
                    this.$.load_button.addEventListener("click", this._loadLevel.bind(this));
                    this._initNames();
                });
            }

            /** gets all existing level names **/
            _initNames() {
                let req = document.createElement('iron-ajax');
                req.url = "/generator/names";
                req.method = "GET";
                req.handleAs = 'json';
                req.contentType = 'application/json';
                req.bubbles = true;
                req.rejectWithRequest = true;

                req.addEventListener('response', e => {
                    this.levels = e.detail.__data.response;
                });

                let genRequest = req.generateRequest();
                req.completes = genRequest.completes;
                return req;
            }

            _loadLevel() {
                window.location.href = "/game?level="+this.selectedLevel;
            }
        }

        window.customElements.define(CritterLevelSelector.is, CritterLevelSelector)
    </script>
</dom-module>
